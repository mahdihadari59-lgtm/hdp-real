const express = require('express');
const cors = require('cors');
const fs = require('fs');
const path = require('path');

const app = express();
app.use(cors());
app.use(express.json());

console.log('ğŸš€ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ HDP Backend Ø¯Ø± Termux...');
console.log('ğŸ“ Ù…Ø³ÛŒØ±:', __dirname);

// Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ .env
require('dotenv').config();

const MAP_API_KEY = process.env.MAP_API_KEY || "service.a26822ae11b84924a29a13225498abf0";

// ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
app.get('/', (req, res) => {
    res.send(`
        <!DOCTYPE html>
        <html lang="fa" dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>HDP Backend</title>
            <style>
                body { font-family: Tahoma; padding: 20px; background: #0c2461; color: white; }
                .container { max-width: 800px; margin: 0 auto; }
                h1 { color: #00ff88; }
                .card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 10px 0; }
                a { color: #00d4ff; text-decoration: none; }
                .status { background: #00ff88; color: #0c2461; padding: 5px 10px; border-radius: 20px; }
                .api-list { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>ğŸš— Ù‡Ø±Ù…Ø²Ú¯Ø§Ù† Ø¯Ø±Ø§ÛŒÙˆØ± Ù¾Ø±Ùˆ - Backend</h1>
                <p><span class="status">ÙØ¹Ø§Ù„</span> Ù†Ø³Ø®Ù‡ Ûµ.Û°.Û° - Termux</p>
                
                <div class="card">
                    <h3>ğŸ“¡ APIâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„:</h3>
                    <div class="api-list">
                        <div><a href="/api/health">GET /api/health</a> - ÙˆØ¶Ø¹ÛŒØª</div>
                        <div><a href="/api/stats">GET /api/stats</a> - Ø¢Ù…Ø§Ø±</div>
                        <div><a href="/api/drivers">GET /api/drivers</a> - Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†</div>
                        <div><a href="/api/map/drivers">GET /api/map/drivers</a> - Ù†Ù‚Ø´Ù‡</div>
                        <div><a href="/api/map/traffic">GET /api/map/traffic</a> - ØªØ±Ø§ÙÛŒÚ©</div>
                        <div><a href="/api/map/route">GET /api/map/route</a> - Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>ğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§:</h3>
                    <p>ğŸŒ Frontend: <a href="http://localhost:8000">http://localhost:8000</a></p>
                    <p>ğŸ—ºï¸ Ù†Ù‚Ø´Ù‡: <a href="http://localhost:8000/map.html">/map.html</a></p>
                </div>
            </div>
        </body>
        </html>
    `);
});

// ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…
app.get('/api/health', (req, res) => {
    res.json({
        success: true,
        project: "Ù‡Ø±Ù…Ø²Ú¯Ø§Ù† Ø¯Ø±Ø§ÛŒÙˆØ± Ù¾Ø±Ùˆ",
        version: "5.0.0",
        status: "ÙØ¹Ø§Ù„",
        environment: "Termux Android",
        time: new Date().toLocaleString('fa-IR'),
        uptime: process.uptime(),
        map: {
            provider: "Neshan",
            status: "ÙØ¹Ø§Ù„",
            key: MAP_API_KEY.substring(0, 15) + '...'
        }
    });
});

// Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ…
app.get('/api/stats', (req, res) => {
    res.json({
        success: true,
        stats: {
            drivers: 1247,
            online: 842,
            trips_today: 8942,
            map_requests: 15642,
            average_rating: 4.8,
            traffic_reduction: "42%",
            accidents_reduction: "35%",
            jobs_created: 17000
        },
        timestamp: new Date().toLocaleString('fa-IR')
    });
});

// Ù„ÛŒØ³Øª Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†
app.get('/api/drivers', (req, res) => {
    const drivers = [
        {
            id: 'DRV-001',
            name: 'Ø±Ø¶Ø§ Ù…Ø­Ù…Ø¯ÛŒ',
            phone: '09121234567',
            rating: 4.8,
            status: 'available',
            experience: '5 Ø³Ø§Ù„',
            car: {
                model: 'Ù¾Ú˜Ùˆ 206',
                color: 'Ø³ÙÛŒØ¯',
                plate: '75-Ø¹ 123',
                year: 1400
            },
            location: {
                lat: 27.1865,
                lng: 56.2768,
                address: 'Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ØŒ Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§'
            },
            registered_at: '1402/08/15',
            trips_completed: 1242,
            earnings_today: 450000
        },
        {
            id: 'DRV-002',
            name: 'Ø¹Ù„ÛŒ Ú©Ø±ÛŒÙ…ÛŒ',
            phone: '09129876543',
            rating: 4.9,
            status: 'on_trip',
            experience: '7 Ø³Ø§Ù„',
            car: {
                model: 'Ø³Ù…Ù†Ø¯',
                color: 'Ù…Ø´Ú©ÛŒ',
                plate: '75-Ø¹ 456',
                year: 1399
            },
            location: {
                lat: 27.1920,
                lng: 56.2650,
                address: 'Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ØŒ Ø¨Ù„ÙˆØ§Ø± Ø§Ù…Ø§Ù…'
            },
            registered_at: '1402/07/22',
            trips_completed: 1856,
            earnings_today: 380000
        },
        {
            id: 'DRV-003',
            name: 'Ù…Ø­Ù…Ø¯ Ø­Ø³ÛŒÙ†ÛŒ',
            phone: '09131112233',
            rating: 4.7,
            status: 'available',
            experience: '3 Ø³Ø§Ù„',
            car: {
                model: 'ØªÛŒØ¨Ø§',
                color: 'Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ',
                plate: '75-Ø¹ 789',
                year: 1401
            },
            location: {
                lat: 27.1750,
                lng: 56.2850,
                address: 'Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ØŒ Ú†Ù‡Ø§Ø±Ø±Ø§Ù‡ Ø³Ø§Ø­Ù„'
            },
            registered_at: '1402/09/10',
            trips_completed: 876,
            earnings_today: 520000
        }
    ];
    
    res.json({
        success: true,
        drivers: drivers,
        count: drivers.length,
        online_count: drivers.filter(d => d.status === 'available').length,
        timestamp: new Date().toLocaleString('fa-IR')
    });
});

// Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡
app.get('/api/map/drivers', (req, res) => {
    const { lat = '27.1832', lng = '56.2666', radius = '5000' } = req.query;
    
    const drivers = [
        {
            id: 'DRV-001',
            name: 'Ø±Ø¶Ø§ Ù…Ø­Ù…Ø¯ÛŒ',
            location: { 
                lat: 27.1865 + (Math.random() * 0.01 - 0.005), 
                lng: 56.2768 + (Math.random() * 0.01 - 0.005) 
            },
            status: 'available',
            rating: 4.8,
            car: { model: 'Ù¾Ú˜Ùˆ 206', color: 'Ø³ÙÛŒØ¯' },
            phone: '09121234567'
        },
        {
            id: 'DRV-002',
            name: 'Ø¹Ù„ÛŒ Ú©Ø±ÛŒÙ…ÛŒ',
            location: { 
                lat: 27.1920 + (Math.random() * 0.01 - 0.005), 
                lng: 56.2650 + (Math.random() * 0.01 - 0.005) 
            },
            status: 'on_trip',
            rating: 4.9,
            car: { model: 'Ø³Ù…Ù†Ø¯', color: 'Ù…Ø´Ú©ÛŒ' },
            phone: '09129876543'
        },
        {
            id: 'DRV-003',
            name: 'Ù…Ø­Ù…Ø¯ Ø­Ø³ÛŒÙ†ÛŒ',
            location: { 
                lat: 27.1750 + (Math.random() * 0.01 - 0.005), 
                lng: 56.2850 + (Math.random() * 0.01 - 0.005) 
            },
            status: 'available',
            rating: 4.7,
            car: { model: 'ØªÛŒØ¨Ø§', color: 'Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ' },
            phone: '09131112233'
        },
        {
            id: 'DRV-004',
            name: 'Ø­Ø³Ù† Ø±Ø¶Ø§ÛŒÛŒ',
            location: { 
                lat: 27.1890 + (Math.random() * 0.01 - 0.005), 
                lng: 56.2720 + (Math.random() * 0.01 - 0.005) 
            },
            status: 'available',
            rating: 4.6,
            car: { model: 'Ø¯Ù†Ø§', color: 'Ø¢Ø¨ÛŒ' },
            phone: '09143215678'
        }
    ];
    
    res.json({
        success: true,
        drivers: drivers,
        count: drivers.length,
        online: drivers.filter(d => d.status === 'available').length,
        center: { lat: parseFloat(lat), lng: parseFloat(lng) },
        radius: parseInt(radius),
        timestamp: new Date().toLocaleString('fa-IR'),
        map_info: {
            provider: "Neshan",
            key: MAP_API_KEY.substring(0, 10) + '...'
        }
    });
});

// ØªØ±Ø§ÙÛŒÚ© Ø²Ù†Ø¯Ù‡
app.get('/api/map/traffic', (req, res) => {
    const { lat = '27.1832', lng = '56.2666' } = req.query;
    
    const levels = ['light', 'moderate', 'heavy', 'severe'];
    const level = levels[Math.floor(Math.random() * levels.length)];
    
    const levelText = {
        'light': 'ğŸŸ¢ Ø³Ø¨Ú©',
        'moderate': 'ğŸŸ¡ Ù…ØªÙˆØ³Ø·', 
        'heavy': 'ğŸŸ  Ø³Ù†Ú¯ÛŒÙ†',
        'severe': 'ğŸ”´ Ø´Ø¯ÛŒØ¯'
    };
    
    res.json({
        success: true,
        traffic: {
            location: { lat: parseFloat(lat), lng: parseFloat(lng) },
            level: level,
            level_text: levelText[level],
            speed: Math.floor(Math.random() * 60) + 20,
            congestion: Math.floor(Math.random() * 100),
            hotspots: [
                { name: 'Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§', congestion: 85, type: 'intersection', lat: 27.1865, lng: 56.2768 },
                { name: 'Ø¨Ù„ÙˆØ§Ø± Ø§Ù…Ø§Ù…', congestion: 72, type: 'boulevard', lat: 27.1920, lng: 56.2650 },
                { name: 'Ú†Ù‡Ø§Ø±Ø±Ø§Ù‡ Ø³Ø§Ø­Ù„', congestion: 68, type: 'intersection', lat: 27.1750, lng: 56.2850 },
                { name: 'ÙØ±ÙˆØ¯Ú¯Ø§Ù‡', congestion: 45, type: 'airport', lat: 27.1587, lng: 56.1728 }
            ]
        },
        timestamp: new Date().toLocaleString('fa-IR')
    });
});

// Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ
app.get('/api/map/route', async (req, res) => {
    const { origin = '27.1832,56.2666', destination = '27.1865,56.2768' } = req.query;
    
    try {
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ
        const [origLat, origLng] = origin.split(',').map(Number);
        const [destLat, destLng] = destination.split(',').map(Number);
        
        const distance = Math.sqrt(
            Math.pow(destLat - origLat, 2) + 
            Math.pow(destLng - origLng, 2)
        ) * 111; // ØªÙ‚Ø±ÛŒØ¨ Ú©ÛŒÙ„ÙˆÙ…ØªØ±
        
        const duration = distance * 1.5; // ØªÙ‚Ø±ÛŒØ¨ Ø¯Ù‚ÛŒÙ‚Ù‡
        
        res.json({
            success: true,
            route: {
                origin: { lat: origLat, lng: origLng },
                destination: { lat: destLat, lng: destLng },
                distance: { 
                    value: Math.round(distance * 1000),
                    text: `${distance.toFixed(1)} Ú©ÛŒÙ„ÙˆÙ…ØªØ±`
                },
                duration: {
                    value: Math.round(duration * 60),
                    text: `${Math.round(duration)} Ø¯Ù‚ÛŒÙ‚Ù‡`
                },
                steps: [
                    { instruction: 'Ø¨Ù‡ Ø³Ù…Øª Ø´Ù…Ø§Ù„ Ø­Ø±Ú©Øª Ú©Ù†ÛŒØ¯', distance: '200 Ù…ØªØ±', duration: '1 Ø¯Ù‚ÛŒÙ‚Ù‡' },
                    { instruction: 'Ø¯Ø± Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§ Ø¨Ù‡ Ø±Ø§Ø³Øª Ø¨Ù¾ÛŒÚ†ÛŒØ¯', distance: '1.2 Ú©ÛŒÙ„ÙˆÙ…ØªØ±', duration: '3 Ø¯Ù‚ÛŒÙ‚Ù‡' },
                    { instruction: 'Ø¯Ø± ØªÙ‚Ø§Ø·Ø¹ Ø¨Ù‡ Ú†Ù¾ Ø¨Ù¾ÛŒÚ†ÛŒØ¯', distance: '600 Ù…ØªØ±', duration: '2 Ø¯Ù‚ÛŒÙ‚Ù‡' },
                    { instruction: 'Ø¨Ù‡ Ù…Ù‚ØµØ¯ Ø¨Ø±Ø³ÛŒØ¯', distance: '50 Ù…ØªØ±', duration: '1 Ø¯Ù‚ÛŒÙ‚Ù‡' }
                ],
                traffic_level: 'moderate',
                has_toll: false,
                estimated_cost: Math.round(distance * 10000)
            },
            provider: "Neshan",
            timestamp: new Date().toLocaleString('fa-IR')
        });
    } catch (error) {
        res.status(500).json({
            success: false,
            message: 'Ø®Ø·Ø§ Ø¯Ø± Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ',
            error: error.message
        });
    }
});

// Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ - Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ
app.get('/api/ai/predict', (req, res) => {
    const riskScore = Math.floor(Math.random() * 100);
    const riskLevel = riskScore > 70 ? 'high' : riskScore > 40 ? 'medium' : 'low';
    
    const levelText = {
        'high': 'ğŸ”´ Ø¨Ø§Ù„Ø§',
        'medium': 'ğŸŸ¡ Ù…ØªÙˆØ³Ø·', 
        'low': 'ğŸŸ¢ Ù¾Ø§ÛŒÛŒÙ†'
    };
    
    const recommendations = {
        'high': ['Ú©Ø§Ù‡Ø´ Ø³Ø±Ø¹Øª', 'Ø±Ø¹Ø§ÛŒØª ÙØ§ØµÙ„Ù‡ Ø²ÛŒØ§Ø¯', 'Ø§Ø³ØªØ±Ø§Ø­Øª Ø¨ÛŒÙ† Ø±Ø§Ù‡'],
        'medium': ['Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ù…Ø­ØªØ§Ø·Ø§Ù†Ù‡', 'Ø±Ø¹Ø§ÛŒØª Ù‚ÙˆØ§Ù†ÛŒÙ†', 'Ú©Ù†ØªØ±Ù„ Ø³Ø±Ø¹Øª'],
        'low': ['Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ù…Ø¹Ù…ÙˆÙ„ÛŒ', 'Ø­ÙØ¸ Ø³Ø±Ø¹Øª Ù…Ø¬Ø§Ø²', 'Ù„Ø°Øª Ø¨Ø±Ø¯Ù† Ø§Ø² Ø³ÙØ±']
    };
    
    res.json({
        success: true,
        prediction: {
            risk_score: riskScore,
            risk_level: riskLevel,
            risk_level_text: levelText[riskLevel],
            confidence: 0.85 + (Math.random() * 0.1),
            message: riskLevel === 'high' ? 'âš ï¸ Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯! Ø´Ø±Ø§ÛŒØ· Ù†Ø§Ù…Ù†Ø§Ø³Ø¨' : 
                    riskLevel === 'medium' ? 'âš ï¸ Ù…Ø±Ø§Ù‚Ø¨ Ø¨Ø§Ø´ÛŒØ¯' : 'âœ… Ø´Ø±Ø§ÛŒØ· Ù…Ù†Ø§Ø³Ø¨',
            recommendations: recommendations[riskLevel],
            factors: [
                'ÙˆØ¶Ø¹ÛŒØª ØªØ±Ø§ÙÛŒÚ©',
                'Ø´Ø±Ø§ÛŒØ· Ø¬ÙˆÛŒ',
                'Ø±ÙØªØ§Ø± Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ',
                'Ø³Ù„Ø§Ù…Øª ÙˆØ³ÛŒÙ„Ù‡ Ù†Ù‚Ù„ÛŒÙ‡'
            ]
        },
        timestamp: new Date().toLocaleString('fa-IR')
    });
});

// Ø«Ø¨Øª Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯
app.post('/api/drivers/register', (req, res) => {
    const { name, phone, car_model, car_color, experience } = req.body;
    
    if (!name || !phone) {
        return res.status(400).json({
            success: false,
            message: 'Ù†Ø§Ù… Ùˆ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª'
        });
    }
    
    const newDriver = {
        id: 'DRV-' + Date.now(),
        name: name,
        phone: phone,
        rating: 5.0,
        status: 'pending',
        experience: experience || 'Ø¬Ø¯ÛŒØ¯',
        car: {
            model: car_model || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡',
            color: car_color || 'Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡',
            plate: 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø«Ø¨Øª'
        },
        location: {
            lat: 27.1832 + (Math.random() * 0.02 - 0.01),
            lng: 56.2666 + (Math.random() * 0.02 - 0.01),
            address: 'Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³'
        },
        registered_at: new Date().toLocaleString('fa-IR'),
        verification_steps: [
            'ØªØ§ÛŒÛŒØ¯ Ù…Ø¯Ø§Ø±Ú©',
            'Ø¢Ù…ÙˆØ²Ø´ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†',
            'ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø­Ø³Ø§Ø¨'
        ]
    };
    
    res.json({
        success: true,
        message: `Ø±Ø§Ù†Ù†Ø¯Ù‡ ${name} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯`,
        driver: newDriver,
        next_steps: [
            'Ø§Ø±Ø³Ø§Ù„ Ù…Ø¯Ø§Ø±Ú© Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ',
            'Ø´Ø±Ú©Øª Ø¯Ø± Ø¯ÙˆØ±Ù‡ Ø¢Ù…ÙˆØ²Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†',
            'Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø±Ø§Ù†Ù†Ø¯Ù‡'
        ],
        contact: {
            phone: 'Û°Û·Û¶-Û³Û²Û²Û´Û¹Û·Û¹Û²',
            email: 'info@hormozgandriver.ir'
        }
    });
});

// ÙˆØ¶Ø¹ÛŒØª Emergency
app.post('/api/emergency/sos', (req, res) => {
    const { driver_id, location, reason } = req.body;
    
    res.json({
        success: true,
        emergency: {
            id: 'EMS-' + Date.now(),
            driver_id: driver_id,
            location: location || { lat: 27.1832, lng: 56.2666 },
            reason: reason || 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù…Ú©',
            status: 'help_sent',
            timestamp: new Date().toLocaleString('fa-IR'),
            response: {
                police_notified: true,
                ambulance_notified: true,
                eta: '10 Ø¯Ù‚ÛŒÙ‚Ù‡',
                contact: 'Û±Û±Û° - Û±Û±Ûµ'
            }
        },
        message: 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù…Ú© Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ù†ÛŒØ±ÙˆÙ‡Ø§ÛŒ Ø§Ù…Ø¯Ø§Ø¯ÛŒ Ø¯Ø± Ø±Ø§Ù‡ Ù‡Ø³ØªÙ†Ø¯.'
    });
});

// ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ… (Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯)
app.get('/api/system/status', (req, res) => {
    const memoryUsage = process.memoryUsage();
    
    res.json({
        success: true,
        system: {
            node_version: process.version,
            platform: process.platform,
            uptime: Math.floor(process.uptime()),
            memory: {
                rss: Math.round(memoryUsage.rss / 1024 / 1024) + ' MB',
                heapTotal: Math.round(memoryUsage.heapTotal / 1024 / 1024) + ' MB',
                heapUsed: Math.round(memoryUsage.heapUsed / 1024 / 1024) + ' MB'
            },
            connections: Math.floor(Math.random() * 100) + 50
        },
        services: {
            api: 'online',
            database: 'online',
            map: 'online',
            ai: 'online',
            emergency: 'online'
        },
        timestamp: new Date().toLocaleString('fa-IR')
    });
});

// 404 Handler
app.use((req, res) => {
    res.status(404).json({
        success: false,
        message: 'API Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯',
        available_apis: [
            '/api/health',
            '/api/stats', 
            '/api/drivers',
            '/api/map/drivers',
            '/api/map/traffic',
            '/api/map/route',
            '/api/ai/predict',
            '/api/system/status'
        ]
    });
});

// Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ±
const PORT = 3000;
app.listen(PORT, '0.0.0.0', () => {
    console.log('='.repeat(50));
    console.log('ğŸš— Ù‡Ø±Ù…Ø²Ú¯Ø§Ù† Ø¯Ø±Ø§ÛŒÙˆØ± Ù¾Ø±Ùˆ - Backend');
    console.log(`ğŸŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø±ÙˆÛŒ: http://0.0.0.0:${PORT}`);
    console.log(`ğŸ“… ØªØ§Ø±ÛŒØ®: ${new Date().toLocaleString('fa-IR')}`);
    console.log('='.repeat(50));
    console.log('\nğŸ“¡ APIâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„:');
    console.log('  GET  /                 - ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ');
    console.log('  GET  /api/health       - ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…');
    console.log('  GET  /api/stats        - Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ…');
    console.log('  GET  /api/drivers      - Ù„ÛŒØ³Øª Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†');
    console.log('  GET  /api/map/drivers  - Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡');
    console.log('  GET  /api/map/traffic  - ØªØ±Ø§ÙÛŒÚ© Ø²Ù†Ø¯Ù‡');
    console.log('  GET  /api/map/route    - Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ');
    console.log('  GET  /api/ai/predict   - Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ AI');
    console.log('  POST /api/drivers/register - Ø«Ø¨Øª Ø±Ø§Ù†Ù†Ø¯Ù‡');
    console.log('  POST /api/emergency/sos - SOS Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ');
    console.log('\nğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§:');
    console.log(`  Frontend: http://localhost:8000`);
    console.log(`  Ù†Ù‚Ø´Ù‡: http://localhost:8000/map.html`);
    console.log('='.repeat(50));
});
