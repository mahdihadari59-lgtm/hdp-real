<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ğŸš– Ø±Ø²Ø±Ùˆ Ø³ÙØ± Ù‡ÙˆØ´Ù…Ù†Ø¯ - HDP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/vazirmatn@33.0.0/Vazirmatn-font-face.css" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Vazirmatn', Tahoma;
            background: linear-gradient(135deg, #0c2461, #1e3799);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 30px 0;
        }
        
        .logo {
            font-size: 3rem;
            color: #00ff88;
            margin-bottom: 15px;
        }
        
        .title {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        /* Ù…Ø±Ø§Ø­Ù„ Ø±Ø²Ø±Ùˆ */
        .booking-steps {
            display: flex;
            justify-content: space-between;
            margin: 40px 0;
            position: relative;
        }
        
        .booking-steps::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(255,255,255,0.2);
            z-index: 1;
        }
        
        .step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }
        
        .step-circle {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.5rem;
            transition: all 0.3s;
        }
        
        .step.active .step-circle {
            background: #00ff88;
            color: #0c2461;
            transform: scale(1.1);
        }
        
        .step.completed .step-circle {
            background: #00A693;
        }
        
        /* ÙØ±Ù… */
        .booking-form {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            color: #00d4ff;
            font-weight: bold;
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: white;
            font-family: 'Vazirmatn';
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #00ff88;
            background: rgba(255,255,255,0.1);
        }
        
        /* Ø¯Ú©Ù…Ù‡ */
        .btn {
            background: linear-gradient(135deg, #00ff88, #00A693);
            color: #0c2461;
            border: none;
            padding: 16px 40px;
            border-radius: 50px;
            font-family: 'Vazirmatn';
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px auto;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,255,136,0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Ù„ÛŒØ³Øª Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† */
        .drivers-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .driver-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .driver-card:hover {
            background: rgba(255,255,255,0.1);
            border-color: #00ff88;
            transform: translateY(-5px);
        }
        
        .driver-card.selected {
            background: rgba(0,255,136,0.1);
            border-color: #00ff88;
        }
        
        .driver-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #00A693, #003366);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .driver-rating {
            color: #ffcc00;
            margin: 10px 0;
        }
        
        /* Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ± */
        .trip-details {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .trip-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-item {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* Ù¾Ø±Ø¯Ø§Ø®Øª */
        .payment-methods {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        
        .payment-method {
            flex: 1;
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .payment-method:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .payment-method.selected {
            background: rgba(0,255,136,0.1);
            border: 2px solid #00ff88;
        }
        
        /* Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 768px) {
            .booking-steps {
                flex-direction: column;
                gap: 30px;
            }
            
            .booking-steps::before {
                display: none;
            }
            
            .trip-info {
                grid-template-columns: 1fr;
            }
            
            .drivers-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ù‡Ø¯Ø± -->
        <div class="header">
            <div class="logo">ğŸš–</div>
            <h1 class="title">Ø±Ø²Ø±Ùˆ Ø³ÙØ± Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>
            <p>Ø³Ø±ÛŒØ¹ØŒ Ø§Ù…Ù† Ùˆ Ù…Ø·Ù…Ø¦Ù† Ø¨Ø§ Ù‡Ø±Ù…Ø²Ú¯Ø§Ù† Ø¯Ø±Ø§ÛŒÙˆØ± Ù¾Ø±Ùˆ</p>
        </div>
        
        <!-- Ù…Ø±Ø§Ø­Ù„ Ø±Ø²Ø±Ùˆ -->
        <div class="booking-steps">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <div>Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯</div>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <div>Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§Ù†Ù†Ø¯Ù‡</div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <div>ØªØ§ÛŒÛŒØ¯ Ø³ÙØ±</div>
            </div>
            <div class="step" id="step4">
                <div class="step-circle">4</div>
                <div>Ù¾Ø±Ø¯Ø§Ø®Øª</div>
            </div>
        </div>
        
        <!-- Ù…Ø±Ø­Ù„Ù‡ Û±: Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯ -->
        <div class="booking-form" id="step1-form">
            <h2 style="margin-bottom: 25px; color: #00ff88;">
                <i class="fas fa-map-marker-alt"></i> Ù…Ø´Ø®ØµØ§Øª Ø³ÙØ±
            </h2>
            
            <div class="form-group">
                <label class="form-label">ğŸ“ Ù…Ø¨Ø¯Ø§ (Ø´Ø±ÙˆØ¹ Ø³ÙØ±)</label>
                <input type="text" class="form-input" id="pickup" 
                       placeholder="Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚ Ù…Ø¨Ø¯Ø§ (Ù…Ø«Ø§Ù„: Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ØŒ Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§)"
                       value="Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ØŒ Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§">
            </div>
            
            <div class="form-group">
                <label class="form-label">ğŸ¯ Ù…Ù‚ØµØ¯ (Ù¾Ø§ÛŒØ§Ù† Ø³ÙØ±)</label>
                <input type="text" class="form-input" id="destination" 
                       placeholder="Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚ Ù…Ù‚ØµØ¯ (Ù…Ø«Ø§Ù„: Ù‚Ø´Ù…ØŒ ÙØ±ÙˆØ¯Ú¯Ø§Ù‡ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ)"
                       value="Ù‚Ø´Ù…ØŒ ÙØ±ÙˆØ¯Ú¯Ø§Ù‡ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ">
            </div>
            
            <div class="form-group">
                <label class="form-label">ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø³Ø§ÙØ±Ø§Ù†</label>
                <div style="display: flex; gap: 10px;">
                    <button class="form-input" style="flex: 1;" onclick="updatePassengers(-1)">-</button>
                    <input type="text" class="form-input" id="passengers" value="1" readonly style="text-align: center;">
                    <button class="form-input" style="flex: 1;" onclick="updatePassengers(1)">+</button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ğŸ’ Ù†ÙˆØ¹ Ø³ÙØ±</label>
                <div style="display: flex; gap: 10px;">
                    <button class="form-input trip-type" data-type="normal" onclick="selectTripType('normal')" style="flex: 1;">
                        ğŸš— Ù…Ø¹Ù…ÙˆÙ„ÛŒ
                    </button>
                    <button class="form-input trip-type" data-type="premium" onclick="selectTripType('premium')" style="flex: 1;">
                        â­ Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…
                    </button>
                    <button class="form-input trip-type" data-type="share" onclick="selectTripType('share')" style="flex: 1;">
                        ğŸ‘¥ Ø§Ø´ØªØ±Ø§Ú©ÛŒ
                    </button>
                </div>
            </div>
            
            <button class="btn" onclick="calculateRoute()">
                <i class="fas fa-route"></i>
                Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³ÛŒØ± Ùˆ Ù‡Ø²ÛŒÙ†Ù‡
            </button>
        </div>
        
        <!-- Ù…Ø±Ø­Ù„Ù‡ Û²: Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§Ù†Ù†Ø¯Ù‡ -->
        <div class="booking-form" id="step2-form" style="display: none;">
            <h2 style="margin-bottom: 25px; color: #00ff88;">
                <i class="fas fa-users"></i> Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§Ù†Ù†Ø¯Ù‡
            </h2>
            
            <p style="margin-bottom: 20px; color: #aaa;">
                Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§:
            </p>
            
            <div class="drivers-list" id="driversList">
                <!-- Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                <div style="text-align: center; padding: 40px; color: #aaa;">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p style="margin-top: 15px;">Ø¯Ø± Ø­Ø§Ù„ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†...</p>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn" onclick="previousStep()">
                    <i class="fas fa-arrow-right"></i>
                    Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„
                </button>
                <button class="btn" id="selectDriverBtn" disabled onclick="nextStep()">
                    <i class="fas fa-check"></i>
                    ØªØ§ÛŒÛŒØ¯ Ø±Ø§Ù†Ù†Ø¯Ù‡
                </button>
            </div>
        </div>
        
        <!-- Ù…Ø±Ø­Ù„Ù‡ Û³: ØªØ§ÛŒÛŒØ¯ Ø³ÙØ± -->
        <div class="booking-form" id="step3-form" style="display: none;">
            <h2 style="margin-bottom: 25px; color: #00ff88;">
                <i class="fas fa-check-circle"></i> ØªØ§ÛŒÛŒØ¯ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ±
            </h2>
            
            <div class="trip-details">
                <h3>ğŸ“‹ Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ±</h3>
                <div class="trip-info">
                    <div class="info-item">
                        <div class="info-label">Ù…Ø¨Ø¯Ø§</div>
                        <div class="info-value" id="summary-pickup">Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ØŒ Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Ù…Ù‚ØµØ¯</div>
                        <div class="info-value" id="summary-destination">Ù‚Ø´Ù…ØŒ ÙØ±ÙˆØ¯Ú¯Ø§Ù‡</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Ø±Ø§Ù†Ù†Ø¯Ù‡</div>
                        <div class="info-value" id="summary-driver">Ø±Ø¶Ø§ Ù…Ø­Ù…Ø¯ÛŒ</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Ù…Ø³Ø§ÙØª</div>
                        <div class="info-value" id="summary-distance">8.5 Ú©ÛŒÙ„ÙˆÙ…ØªØ±</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Ø²Ù…Ø§Ù†</div>
                        <div class="info-value" id="summary-duration">12 Ø¯Ù‚ÛŒÙ‚Ù‡</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Ù‡Ø²ÛŒÙ†Ù‡</div>
                        <div class="info-value" id="summary-cost">85,000 ØªÙˆÙ…Ø§Ù†</div>
                    </div>
                </div>
            </div>
            
            <div style="margin: 25px 0;">
                <h3>ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</h3>
                <textarea class="form-input" id="notes" rows="3" 
                          placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù†Ù†Ø¯Ù‡..."></textarea>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn" onclick="previousStep()">
                    <i class="fas fa-arrow-right"></i>
                    Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„
                </button>
                <button class="btn" onclick="nextStep()">
                    <i class="fas fa-credit-card"></i>
                    Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª
                </button>
            </div>
        </div>
        
        <!-- Ù…Ø±Ø­Ù„Ù‡ Û´: Ù¾Ø±Ø¯Ø§Ø®Øª -->
        <div class="booking-form" id="step4-form" style="display: none;">
            <h2 style="margin-bottom: 25px; color: #00ff88;">
                <i class="fas fa-credit-card"></i> Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù…Ù†
            </h2>
            
            <div class="trip-details" style="margin-bottom: 30px;">
                <h3>ğŸ’° Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; color: #00ff88;" id="payment-amount">85,000</div>
                    <div style="color: #aaa;">ØªÙˆÙ…Ø§Ù†</div>
                </div>
            </div>
            
            <h3>ğŸ’³ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
            <div class="payment-methods">
                <div class="payment-method" onclick="selectPaymentMethod('cash')">
                    <div style="font-size: 2rem;">ğŸ’µ</div>
                    <div>Ù†Ù‚Ø¯ÛŒ</div>
                    <div style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ù…Ø§Ø´ÛŒÙ†</div>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod('online')">
                    <div style="font-size: 2rem;">ğŸ’³</div>
                    <div>Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
                    <div style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">Ø¯Ø±Ú¯Ø§Ù‡ Ø§Ù…Ù†</div>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod('wallet')">
                    <div style="font-size: 2rem;">ğŸ‘›</div>
                    <div>Ú©ÛŒÙ Ù¾ÙˆÙ„</div>
                    <div style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">Ù…ÙˆØ¬ÙˆØ¯ÛŒ: Û° ØªÙˆÙ…Ø§Ù†</div>
                </div>
            </div>
            
            <div style="margin-top: 30px; background: rgba(0,255,136,0.1); padding: 20px; border-radius: 10px;">
                <h3><i class="fas fa-shield-alt"></i> ØªØ¶Ù…ÛŒÙ† Ø§Ù…Ù†ÛŒØª HDP</h3>
                <ul style="margin-top: 10px; padding-right: 20px;">
                    <li>âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù…Ù† Ø¨Ø§ SSL</li>
                    <li>âœ… Ú¯Ø§Ø±Ø§Ù†ØªÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª ÙˆØ¬Ù‡</li>
                    <li>âœ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Û²Û´ Ø³Ø§Ø¹ØªÙ‡</li>
                    <li>âœ… Ø¨ÛŒÙ…Ù‡ Ù…Ø³Ø§ÙØ±ØªÛŒ</li>
                </ul>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                <button class="btn" onclick="previousStep()">
                    <i class="fas fa-arrow-right"></i>
                    Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„
                </button>
                <button class="btn" onclick="confirmBooking()">
                    <i class="fas fa-check-double"></i>
                    ØªØ§ÛŒÛŒØ¯ Ùˆ Ø±Ø²Ø±Ùˆ Ù†Ù‡Ø§ÛŒÛŒ
                </button>
            </div>
        </div>
        
        <!-- Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª -->
        <div id="successMessage" style="display: none; text-align: center; padding: 40px;">
            <div style="font-size: 4rem; color: #00ff88;">ğŸ‰</div>
            <h2 style="margin: 20px 0 10px 0;">Ø³ÙØ± Ø´Ù…Ø§ Ø±Ø²Ø±Ùˆ Ø´Ø¯!</h2>
            <p style="color: #aaa; margin-bottom: 30px;">Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ: <span id="bookingCode" style="color: #00ff88;">HDP-2025-001</span></p>
            <button class="btn" onclick="window.location.href = 'map.html'">
                <i class="fas fa-map-marked-alt"></i>
                Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡
            </button>
        </div>
    </div>

    <script>
        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙØ±
        let bookingData = {
            step: 1,
            pickup: 'Ø¨Ù†Ø¯Ø±Ø¹Ø¨Ø§Ø³ØŒ Ù…ÛŒØ¯Ø§Ù† Ø´Ù‡Ø¯Ø§',
            destination: 'Ù‚Ø´Ù…ØŒ ÙØ±ÙˆØ¯Ú¯Ø§Ù‡ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ',
            passengers: 1,
            tripType: 'normal',
            selectedDriver: null,
            routeInfo: null,
            paymentMethod: null,
            notes: ''
        };
        
        // Ù…Ø±Ø§Ø­Ù„
        function updateSteps() {
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø±Ø§Ø­Ù„ ÙØ¹Ø§Ù„
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step${i}`);
                const formEl = document.getElementById(`step${i}-form`);
                
                if (i === bookingData.step) {
                    stepEl.classList.add('active');
                    stepEl.classList.remove('completed');
                    formEl.style.display = 'block';
                } else if (i < bookingData.step) {
                    stepEl.classList.remove('active');
                    stepEl.classList.add('completed');
                    formEl.style.display = 'none';
                } else {
                    stepEl.classList.remove('active');
                    stepEl.classList.remove('completed');
                    formEl.style.display = 'none';
                }
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªÙ† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            if (bookingData.step === 2) {
                document.getElementById('selectDriverBtn').disabled = !bookingData.selectedDriver;
            }
        }
        
        // Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ
        function nextStep() {
            if (bookingData.step < 4) {
                bookingData.step++;
                updateSteps();
                updateFormData();
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Û²
                if (bookingData.step === 2) {
                    loadDrivers();
                }
            }
        }
        
        // Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„ÛŒ
        function previousStep() {
            if (bookingData.step > 1) {
                bookingData.step--;
                updateSteps();
            }
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø³Ø§ÙØ±Ø§Ù†
        function updatePassengers(change) {
            constnewValue = bookingData.passengers + change;
            if (newValue >= 1 && newValue <= 4) {
                bookingData.passengers = newValue;
                document.getElementById('passengers').value = newValue;
            }
        }
        
        // Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ø³ÙØ±
        function selectTripType(type) {
            bookingData.tripType = type;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            document.querySelectorAll('.trip-type').forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.style.background = 'rgba(0,255,136,0.2)';
                    btn.style.borderColor = '#00ff88';
                } else {
                    btn.style.background = '';
                    btn.style.borderColor = '';
                }
            });
        }
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³ÛŒØ± Ùˆ Ù‡Ø²ÛŒÙ†Ù‡
        async function calculateRoute() {
            const pickup = document.getElementById('pickup').value;
            const destination = document.getElementById('destination').value;
            
            if (!pickup || !destination) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            bookingData.pickup = pickup;
            bookingData.destination = destination;
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³ÛŒØ±
            try {
                const response = await fetch(`http://localhost:3000/api/map/route?origin=27.1832,56.2666&destination=27.1865,56.2768`);
                const data = await response.json();
                
                if (data.success) {
                    bookingData.routeInfo = data.route;
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø³ÙØ±
                    let baseCost = 10000; // Ù‡Ø²ÛŒÙ†Ù‡ Ù¾Ø§ÛŒÙ‡
                    const distance = data.route.distance?.value || 8500;
                    const duration = data.route.duration?.value || 720;
                    
                    let cost = baseCost + (distance / 1000 * 5000) + (duration / 60 * 2000);
                    
                    // Ø¶Ø±ÛŒØ¨ Ù†ÙˆØ¹ Ø³ÙØ±
                    if (bookingData.tripType === 'premium') cost *= 1.5;
                    if (bookingData.tripType === 'share') cost *= 0.7;
                    
                    // Ø¶Ø±ÛŒØ¨ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø³Ø§ÙØ±Ø§Ù†
                    cost *= bookingData.passengers;
                    
                    bookingData.cost = Math.round(cost / 1000) * 1000;
                    
                    alert(`âœ… Ù…Ø³ÛŒØ± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯!\n\nğŸ“ ÙØ§ØµÙ„Ù‡: ${data.route.distance?.text || '8.5 Ú©ÛŒÙ„ÙˆÙ…ØªØ±'}\nâ±ï¸ Ø²Ù…Ø§Ù†: ${data.route.duration?.text || '12 Ø¯Ù‚ÛŒÙ‚Ù‡'}\nğŸ’° Ù‡Ø²ÛŒÙ†Ù‡ ØªØ®Ù…ÛŒÙ†ÛŒ: ${bookingData.cost.toLocaleString()} ØªÙˆÙ…Ø§Ù†`);
                    
                    // Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ
                    nextStep();
                }
            } catch (error) {
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
                bookingData.routeInfo = {
                    distance: { text: '8.5 Ú©ÛŒÙ„ÙˆÙ…ØªØ±', value: 8500 },
                    duration: { text: '12 Ø¯Ù‚ÛŒÙ‚Ù‡', value: 720 }
                };
                
                bookingData.cost = 85000;
                
                alert(`âœ… Ù…Ø³ÛŒØ± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯ (Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÙˆÙ†Ù‡)\n\nğŸ“ ÙØ§ØµÙ„Ù‡: 8.5 Ú©ÛŒÙ„ÙˆÙ…ØªØ±\nâ±ï¸ Ø²Ù…Ø§Ù†: 12 Ø¯Ù‚ÛŒÙ‚Ù‡\nğŸ’° Ù‡Ø²ÛŒÙ†Ù‡ ØªØ®Ù…ÛŒÙ†ÛŒ: 85,000 ØªÙˆÙ…Ø§Ù†`);
                
                nextStep();
            }
        }
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†
        async function loadDrivers() {
            const driversList = document.getElementById('driversList');
            driversList.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #aaa;">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p style="margin-top: 15px;">Ø¯Ø± Ø­Ø§Ù„ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†...</p>
                </div>
            `;
            
            try {
                const response = await fetch('http://localhost:3000/api/map/drivers');
                const data = await response.json();
                
                if (data.success && data.drivers.length > 0) {
                    displayDrivers(data.drivers);
                } else {
                    throw new Error('Ø±Ø§Ù†Ù†Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯');
                }
            } catch (error) {
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
                const sampleDrivers = [
                    {
                        id: 'DRV-001',
                        name: 'Ø±Ø¶Ø§ Ù…Ø­Ù…Ø¯ÛŒ',
                        rating: 4.8,
                        status: 'available',
                        car: { model: 'Ù¾Ú˜Ùˆ 206', color: 'Ø³ÙÛŒØ¯' },
                        phone: '09121234567',
                        experience: '5 Ø³Ø§Ù„',
                        trips_completed: 1242
                    },
                    {
                        id: 'DRV-002',
                        name: 'Ø¹Ù„ÛŒ Ú©Ø±ÛŒÙ…ÛŒ',
                        rating: 4.9,
                        status: 'available',
                        car: { model: 'Ø³Ù…Ù†Ø¯', color: 'Ù…Ø´Ú©ÛŒ' },
                        phone: '09129876543',
                        experience: '7 Ø³Ø§Ù„',
                        trips_completed: 1856
                    },
                    {
                        id: 'DRV-003',
                        name: 'Ù…Ø­Ù…Ø¯ Ø­Ø³ÛŒÙ†ÛŒ',
                        rating: 4.7,
                        status: 'available',
                        car: { model: 'ØªÛŒØ¨Ø§', color: 'Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ' },
                        phone: '09131112233',
                        experience: '3 Ø³Ø§Ù„',
                        trips_completed: 876
                    }
                ];
                
                displayDrivers(sampleDrivers);
            }
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†
        function displayDrivers(drivers) {
            const driversList = document.getElementById('driversList');
            driversList.innerHTML = '';
            
            drivers.forEach(driver => {
                const driverCard = document.createElement('div');
                driverCard.className = 'driver-card';
                driverCard.onclick = () => selectDriver(driver);
                
                driverCard.innerHTML = `
                    <div class="driver-avatar">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h3>${driver.name}</h3>
                    <div class="driver-rating">
                        ${'â­'.repeat(Math.floor(driver.rating))} ${driver.rating}/5
                    </div>
                    <p>${driver.car.model} - ${driver.car.color}</p>
                    <p style="font-size: 0.9rem; color: #aaa; margin-top: 10px;">
                        <i class="fas fa-history"></i> ${driver.experience || '5 Ø³Ø§Ù„'} ØªØ¬Ø±Ø¨Ù‡
                    </p>
                    <p style="font-size: 0.9rem; color: #aaa;">
                        <i class="fas fa-road"></i> ${driver.trips_completed || 1000}+ Ø³ÙØ±
                    </p>
                `;
                
                driversList.appendChild(driverCard);
            });
        }
        
        // Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§Ù†Ù†Ø¯Ù‡
        function selectDriver(driver) {
            bookingData.selectedDriver = driver;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            document.querySelectorAll('.driver-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.driver-card').classList.add('selected');
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø§Ø¯Ø§Ù…Ù‡
            document.getElementById('selectDriverBtn').disabled = false;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ù„Ø§ØµÙ‡
            updateFormData();
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ù…
        function updateFormData() {
            // Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ±
            document.getElementById('summary-pickup').textContent = bookingData.pickup;
            document.getElementById('summary-destination').textContent = bookingData.destination;
            document.getElementById('summary-driver').textContent = bookingData.selectedDriver?.name || 'Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡';
            document.getElementById('summary-distance').textContent = bookingData.routeInfo?.distance?.text || '8.5 Ú©ÛŒÙ„ÙˆÙ…ØªØ±';
            document.getElementById('summary-duration').textContent = bookingData.routeInfo?.duration?.text || '12 Ø¯Ù‚ÛŒÙ‚Ù‡';
            document.getElementById('summary-cost').textContent = bookingData.cost ? bookingData.cost.toLocaleString() + ' ØªÙˆÙ…Ø§Ù†' : 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ø´Ø¯Ù‡';
            
            // Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª
            if (bookingData.cost) {
                document.getElementById('payment-amount').textContent = bookingData.cost.toLocaleString();
            }
            
            // ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§
            document.getElementById('notes').value = bookingData.notes;
        }
        
        // Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª
        function selectPaymentMethod(method) {
            bookingData.paymentMethod = method;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.closest('.payment-method').classList.add('selected');
        }
        
        // ØªØ§ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ Ø±Ø²Ø±Ùˆ
        async function confirmBooking() {
            if (!bookingData.paymentMethod) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ
            const bookingCode = 'HDP-' + Date.now().toString().slice(-6);
            
            try {
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±
                const bookingPayload = {
                    code: bookingCode,
                    pickup: bookingData.pickup,
                    destination: bookingData.destination,
                    driver: bookingData.selectedDriver,
                    cost: bookingData.cost,
                    payment_method: bookingData.paymentMethod,
                    notes: bookingData.notes,
                    timestamp: new Date().toLocaleString('fa-IR')
                };
                
                // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
                document.getElementById('bookingCode').textContent = bookingCode;
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('step4-form').style.display = 'none';
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
                localStorage.setItem('lastBooking', JSON.stringify(bookingPayload));
                
                console.log('âœ… Ø±Ø²Ø±Ùˆ Ø«Ø¨Øª Ø´Ø¯:', bookingPayload);
                
            } catch (error) {
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø±Ø²Ø±Ùˆ: ' + error.message);
            }
        }
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', () => {
            updateSteps();
            selectTripType('normal');
        });
    </script>
</body>
</html>

<!-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ API -->
<script src="booking-api.js"></script>

<script>
// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙˆØ§Ø¨Ø¹ booking.html Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² API Ø¬Ø¯ÛŒØ¯

// ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø²Ø±Ùˆ Ø¨Ø§ API Ø¬Ø¯ÛŒØ¯
async function confirmBookingAPI() {
    if (!bookingData.paymentMethod) {
        BookingUtils.showMessage('error', 'Ù„Ø·ÙØ§Ù‹ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
        return;
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ù„ÙˆØ¯ÛŒÙ†Ú¯
    BookingUtils.showMessage('info', 'Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª Ø±Ø²Ø±Ùˆ...');
    
    try {
        // Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„
        const bookingPayload = {
            pickup: bookingData.pickup,
            destination: bookingData.destination,
            driver_id: bookingData.selectedDriver?.id,
            passengers: bookingData.passengers,
            trip_type: bookingData.tripType,
            payment_method: bookingData.paymentMethod,
            notes: bookingData.notes,
            customer_name: 'Ù…Ù‡Ù…Ø§Ù†',
            customer_phone: '09123456789'
        };
        
        // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±
        const result = await BookingAPI.createBooking(bookingPayload);
        
        if (result.success) {
            // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙÙ‚ÛŒØª
            const bookingCode = result.booking.code;
            const cost = BookingUtils.formatNumber(result.booking.cost);
            
            document.getElementById('bookingCode').textContent = bookingCode;
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('step4-form').style.display = 'none';
            
            BookingUtils.showMessage('success', 
                `Ø±Ø²Ø±Ùˆ Ù…ÙˆÙÙ‚! Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ: ${bookingCode} - Ù‡Ø²ÛŒÙ†Ù‡: ${cost} ØªÙˆÙ…Ø§Ù†`
            );
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            localStorage.setItem('lastBooking', JSON.stringify(result.booking));
            
            console.log('âœ… Ø±Ø²Ø±Ùˆ Ø«Ø¨Øª Ø´Ø¯:', result.booking);
            
        } else {
            // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§
            BookingUtils.showMessage('error', result.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø±Ø²Ø±Ùˆ');
            
            // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
            if (result.fallback) {
                setTimeout(() => {
                    const bookingCode = 'HDP-OFF-' + Date.now().toString().slice(-6);
                    document.getElementById('bookingCode').textContent = bookingCode;
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('step4-form').style.display = 'none';
                }, 1000);
            }
        }
        
    } catch (error) {
        BookingUtils.showMessage('error', 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
        console.error('Ø®Ø·Ø§:', error);
    }
}

// ØªØ§Ø¨Ø¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† Ø¨Ø§ API Ø¬Ø¯ÛŒØ¯
async function loadDriversAPI() {
    const driversList = document.getElementById('driversList');
    driversList.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #aaa;">
            <i class="fas fa-spinner fa-spin fa-2x"></i>
            <p style="margin-top: 15px;">Ø¯Ø± Ø­Ø§Ù„ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†...</p>
        </div>
    `;
    
    try {
        const drivers = await BookingAPI.getAvailableDrivers();
        displayDrivers(drivers);
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù†:', error);
        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
        const sampleDrivers = BookingAPI.getSampleDrivers();
        displayDrivers(sampleDrivers);
    }
}

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ confirmBooking
const originalConfirmBooking = window.confirmBooking;
window.confirmBooking = function() {
    confirmBookingAPI();
};

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ loadDrivers
const originalLoadDrivers = window.loadDrivers;
window.loadDrivers = function() {
    loadDriversAPI();
};

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø¨Ø¹ calculateRoute Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² API
async function calculateRouteAPI() {
    const pickup = document.getElementById('pickup').value;
    const destination = document.getElementById('destination').value;
    
    if (!pickup || !destination) {
        BookingUtils.showMessage('error', 'Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
        return;
    }
    
    bookingData.pickup = pickup;
    bookingData.destination = destination;
    
    BookingUtils.showMessage('info', 'Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³ÛŒØ± Ùˆ Ù‡Ø²ÛŒÙ†Ù‡...');
    
    try {
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡ ØªÙ‚Ø±ÛŒØ¨ÛŒ
        const estimatedCost = await BookingAPI.estimateCost(
            pickup, 
            destination, 
            bookingData.tripType, 
            bookingData.passengers
        );
        
        bookingData.cost = estimatedCost;
        
        BookingUtils.showMessage('success', 
            `Ù…Ø³ÛŒØ± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯! Ù‡Ø²ÛŒÙ†Ù‡ ØªØ®Ù…ÛŒÙ†ÛŒ: ${BookingUtils.formatNumber(estimatedCost)} ØªÙˆÙ…Ø§Ù†`
        );
        
        // Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ÛŒ
        nextStep();
        
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡:', error);
        
        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        bookingData.cost = 85000;
        BookingUtils.showMessage('success', 
            `Ù…Ø³ÛŒØ± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯ (Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÙˆÙ†Ù‡)! Ù‡Ø²ÛŒÙ†Ù‡: ${BookingUtils.formatNumber(85000)} ØªÙˆÙ…Ø§Ù†`
        );
        
        nextStep();
    }
}

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
window.calculateRoute = calculateRouteAPI;

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ… Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ ØµÙØ­Ù‡
async function loadSystemStats() {
    try {
        const stats = await BookingAPI.getSystemStats();
        if (stats) {
            console.log('ğŸ“Š Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ…:', stats);
            // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù…Ø§Ø± Ø±Ø§ Ø¯Ø± ØµÙØ­Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯
        }
    } catch (error) {
        console.log('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø±');
    }
}

// Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
document.addEventListener('DOMContentLoaded', () => {
    loadSystemStats();
    console.log('ğŸš– Ø³ÛŒØ³ØªÙ… Ø±Ø²Ø±Ùˆ HDP Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!');
});
</script>
